# csv_2/csv/110.csv 構造解析・マッピング修正レポート

## 1. ヘッダー定義

**ファイル名**: csv_2/csv/110.csv

**ヘッダー定義（38列）**:
```
会社名, 都道府県, 代表者名, 法人番号, URL, 業種1, 業種2, 業種3, 業種（細）, 郵便番号, 住所, 設立, 電話番号(窓口), 代表者郵便番号, 代表者住所, 代表者誕生日, 資本金, 上場, 直近決算年月, 直近売上, 直近利益, 説明, 概要, 仕入れ先, 取引先, 取引先銀行, 取締役, 株主, 社員数, オフィス数, 工場数, 店舗数, (空列1), (空列2), (空列3), (空列4), (空列5), (空列6)
```

**実質ヘッダー**: 32項目 + 6空列

---

## 2. ズレの実態

| 行 | 列数 | 差分 | 備考 |
|----|------|------|------|
| 2 | 37 | -1 | 丹羽興業 |
| 3 | 38 | 0 | やぶや |
| 4 | 37 | -1 | 藤吉工業 |
| 5 | 38 | 0 | テクニカルスタッフ |
| 6 | 37 | -1 | ジュニアー |

→ **約半数の行で末尾1列分が欠落**（行末の空列が1つ省略されて出力されている）

---

## 3. 解析用サンプルデータ（ズレている行）

### 行2（列数37・-1ズレ）
```
丹羽興業株式会社,愛知県,前田義浩,9.18E+12,http://www.1049.cc/web/niwa-net/,労働者派遣業,集配利用運送業,一般貨物自動車運送業,その他の事業サービス業,452-0834,愛知県名古屋市西区木前町９８,1957年2月1日,052-504-1511,451-0012,愛知県名古屋市西区稲生町杁先２２００－１０,,100000,非上場,2023年8月1日,2327013,115765,貨物の運送などを行っている会社,三菱重工業（株）の協力会社で物流業務を担当、２０２２年１２月期は売上利益ともに回復を見せた。,東海ニチユ，三菱ふそうトラック・バス，三菱重工冷熱，三菱ロジスネクスト，西日本宇佐美，アクティブシックスオー,村田機械（２７％），三菱重工業（２３％），サカエ理研工業（１０％），三菱重工サーマルシステムズ,三菱ＵＦＪ（小田井）岡崎信金（小田井）愛知（小田井）碧海信金（名古屋）,（取）前田啓子，服部汰馨子（監）奥田健人,ラック（４０．９％），前田義郎（３６．１％），前田啓子（１７．９％）,180,8,0,0,,,,,
```

### 行4（列数37・-1ズレ）
```
藤吉工業株式会社,愛知県,加藤靖始,8.18E+12,https://www.fujiyoshi.co.jp/,建築工事業,給排水・衛生設備工事業,一般機械修理業,検査業,453-0801,愛知県名古屋市中村区太閤４－２－８,1961年4月1日,052-451-8261,,,,200000,非上場,2022年9月1日,6401064,449392,水処理施設の建設や工事を行っている会社,総合水処理プラントメーカー藤吉工業（株）として水処理に関わる事業を行い、財務資金面ともに確立している。,ニイミ（１０％），クボタ浄化槽システム，大栄産業，新明和工業，鶴見製作所，新和コンクリート工業,官公庁（５０％），ゼネコン各社，設備業者，管工事業者,三菱ＵＦＪ（柳橋）中京（中村中央）三井住友（名古屋駅前）三十三（名古屋駅前）,（取）島田吉幸，歸山尚人，滝浩之，櫻井逸昌，大場信良（監）加藤明子,フジヨシ水処理技術研究所（５２．３％），自己株式（４７．６％）,109,10,1,0,,,,,
```

---

## 4. ズレの起点特定

### 4.1 ズレの発生箇所

**末尾の連続空列の欠落**により発生。

- ヘッダー: 店舗数の後に6つの空列がある（計38列）
- ズレ行: 店舗数の後に5つの空列のみ（計37列）
- **起点**: 列31（店舗数）の直後。本来あるべき「空列6」が出力されていない。

→ **列の並びや内容のズレはなく、行末の空列1つが欠けているだけ**

### 4.2 型パターンによる検証（行2）

| 列Idx | ヘッダー | 実際の値 | パターン判定 | 整合 |
|-------|----------|----------|--------------|------|
| 0 | 会社名 | 丹羽興業株式会社 | 会社名形式 | ✓ |
| 1 | 都道府県 | 愛知県 | 都道府県 | ✓ |
| 2 | 代表者名 | 前田義浩 | 人名 | ✓ |
| 3 | 法人番号 | 9.18E+12 | 918…相当→ダミー扱い | ※空にすべき |
| 4 | URL | http://www.1049.cc/... | URL | ✓ |
| 5-8 | 業種1-3,業種（細） | 労働者派遣業,… | 業種 | ✓ |
| 9 | 郵便番号 | 452-0834 | \d{3}-\d{4} | ✓ |
| 10 | 住所 | 愛知県名古屋市… | 都道府県始まり | ✓ |
| 11 | 設立 | 1957年2月1日 | 日付 | ✓ |
| 12 | 電話番号(窓口) | 052-504-1511 | 電話番号 | ✓ |
| 13-14 | 代表者郵便番号,住所 | 451-0012, 愛知県… | 郵便番号+住所 | ✓ |
| 15 | 代表者誕生日 | (空) | - | ✓ |
| 16-20 | 資本金〜直近利益 | 100000,非上場,… | 数値・日付等 | ✓ |
| 21 | 説明 | 貨物の運送など… | 説明文 | ✓ |
| 22 | 概要 | 三菱重工業… | 概要文 | ✓ |
| 23-26 | 仕入れ先〜取引先銀行 | 東海ニチユ,…,三菱ＵＦＪ… | 取引先情報 | ✓ |
| 27 | 取締役 | （取）前田啓子… | 役員表記 | ✓ |
| 28 | 株主 | ラック（４０．９％）… | 株主表記 | ✓ |
| 29-31 | 社員数,オフィス数,工場数,店舗数 | 180,8,0,0 | 数値 | ✓ |
| 32-37 | 空列×6 | 5個のみ | - | 1列欠落 |

→ **列の割り当ては正しく、問題は末尾の空列1つの欠落のみ**

---

## 5. 型（パターン）による再割り当てルール

### 5.1 適用ルール

| ルール | 判定パターン | 処理 |
|--------|--------------|------|
| 法人番号ダミー | 13桁かつ 918… 始まり、または 9.18E+12 等 | 空値に変換 |
| 郵便番号 | `\d{3}-?\d{4}` | 郵便番号列へ |
| 住所 | 都道府県名で始まる | 住所列へ |
| URL | `http` または `https` で始まる | URL列へ |
| 説明文の混入 | 「〜を展開」「の名前で」「〜を行う会社」等が住所に入っている | 概要/説明列へ移動 |
| 役員の混入 | （取）（監）（会）（専）等が住所に入っている | 取締役列へ分離 |

### 5.2 例外検知の例（110.csv内）

**行17 株式会社名古屋テレビ映像**:
- 説明が空、概要に「創業昭和４８年。名古屋テレビ放送の子会社。番組制作を手掛けている。」
- → 説明と概要の境界が曖昧だが、現状の割り当てで矛盾なし

**行3 株式会社やぶやグループ**:
- 概要「愛知県下を中心に店舗展開し「やぶ屋」の名前で居酒屋・飲食店経営を行う…」
- → 「の名前で」は概要内の自然な文言であり、住所への混入ではない

**行23 株式会社イーロジス**:
- 業種が4つ（百貨店，総合スーパー / 百貨店、総合スーパー / 一般貨物自動車運送業 / 倉庫業…）
- ヘッダーは業種1,2,3,業種（細）のため、4つ目は業種（細）に入る
- → パターン上は問題なし

---

## 6. マッピング修正手順

### 6.1 列ズレの修復（必須）

**条件**: データ行の列数がヘッダーより少ない場合

**処理**: 行末に不足分の空列を追加してヘッダー列数（38）に合わせる

```
if len(row) < 38:
    row.extend([''] * (38 - len(row)))
```

### 6.2 値の正規化（推奨）

| 項目 | 条件 | 修正 |
|------|------|------|
| 法人番号 | 918… または 9.18E+12 等 | 空文字列に置換 |
| 設立 | シリアル値等 | 日付形式に変換（任意） |
| 代表者誕生日 | 空 | そのまま |

### 6.3 説明・住所の分離（必要時のみ）

- 住所列に「〜を展開」「〜を行う会社」等の説明文が含まれる行を検出
- 該当部分を 説明 または 概要 へ移動
- 110.csvのサンプル範囲では、この種の混入は検出されず

---

## 7. 結論

| 項目 | 結果 |
|------|------|
| ズレの起点 | 行末の空列1つが欠落（列32-37のうち1つ） |
| 列の並び | 正しい（型パターンと整合） |
| 修復方法 | 列数が37の行に空列を1つ追加 |
| 例外処理 | 法人番号 918… を空に変換するルールを適用 |
