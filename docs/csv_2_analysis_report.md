# csv_2 フォルダ CSV 分析レポート

## 1. ヘッダー完全一致確認

### 想定ヘッダーと実際のCSVの対応

| 想定ヘッダー | 状態 | 備考 |
|-------------|------|------|
| 会社名 | ✅ 完全一致 | 142件で使用 |
| 企業名 | ✅ 完全一致 | 15件（yuzuri等）で使用 |
| 法人番号 | ✅ 完全一致 | 49件で使用 |
| 電話番号 | ✅ 完全一致 | 84件で使用 |
| 電話番号(窓口) | ✅ 完全一致 | 58件で使用 |
| 都道府県 | ✅ 完全一致 | 59件 |
| 住所 | ✅ 完全一致 | 111件 |
| 郵便番号 | ✅ 完全一致 | 111件 |
| 代表者名 | ✅ 完全一致 | 131件 |
| 資本金 | ✅ 完全一致 | 59件 |
| 直近売上 | ✅ 完全一致 | 59件 |
| 直近利益 | ✅ 完全一致 | 59件 |
| 売上(百万) | ⚠️ 該当なし | 「売上高」「直近売上」が使用 |
| 売上高 | ✅ 完全一致 | 別形式あり（「14,700百万円」等） |
| 資本金(千円) | ⚠️ 類似のみ | 「資本金」が使用 |

### ヘッダー正規化の必要性
- 全角/半角スペース: 一部に `売上規模\n（百万円）` のように改行含みあり
- 括弧: 全角（ ）と半角 ( ) が混在する可能性 → 正規化してマッチング推奨
- 会社名/企業名: 両方存在。名寄せ時に `会社名 or 企業名` で取得

---

## 2. 数値データの形式チェック

### 直近売上
| 形式 | 例 | 備考 |
|------|-----|------|
| 数値（円単位想定） | 2288848, 2327013, 658989 | カンマなし |
| 数値（千円/百万円の可能性） | 230227050, 256927000 | 桁数で単位推定が必要 |
| **日付（列ズレ）** | 2022年9月1日 | 異常値→スキップ |

### 直近利益
| 形式 | 例 | 備考 |
|------|-----|------|
| 数値 | 32018, 19970, 836432 | カンマなし |
| **日付（列ズレ）** | 2022年7月1日 | 異常値 |

### 資本金
| 形式 | 例 | 備考 |
|------|-----|------|
| 数値（千円単位が多い） | 10000, 60000, 100000 | 1万=1000万円の可能性 |
| **日付（列ズレ）** | 1974/1/12, 1947/7/4 | 代表者誕生日等の混入 |

### 売上高
| 形式 | 例 | 備考 |
|------|-----|------|
| 「XXX百万円」 | 14,700百万円, 837百万円 | カンマ除去＋百万円パース必要 |

### 従業員数・社員数
- 数値のみ（カンマなし）: 380, 87, 205 等

### 数値パース方針
1. カンマ除去
2. 「百万円」「千円」等の単位付きはパースして適切な数値に変換
3. 日付形式（YYYY年M月D日, YYYY/M/D）が混入した場合は null
4. 指数表記（9.18E+12）は float 経由で整数化

---

## 3. マッチングキー検証

### 法人番号
| 形式 | 例 | 件数 |
|------|-----|------|
| 13桁数値 | 4180005017200, 9180001072698 | 多数 |
| 指数表記 | 9.18E+12, 8.18E+12 | 一部ファイル |
| ハイフン | なし | - |

**正規化**: 指数表記→13桁整数。12桁は先頭0パディング可。英字含むは無効。

### 電話番号
| 形式 | 例 | 備考 |
|------|-----|------|
| ハイフン区切り | 052-504-1511, 06-6586-5000 | 標準的 |
| **日付（列ズレ）** | 1961年4月1日 | 代表者誕生日の混入 |
| **住所（列ズレ）** | 愛知県名古屋市中区... | 住所の混入 |

**正規化**: ハイフンは維持。数字以外が含まれる場合は無効とみなす（桁数チェック）。

---

## 4. インポート処理の方針

1. **データソース**: `fixed_csv_2` を優先（列ズレ補正済み）、なければ `csv_2`
2. **マッチング**: 法人番号 優先 → 電話番号 フォールバック
3. **ヘッダーマッピング**: 正規化（空白・括弧統一）してマッチ
4. **数値変換**: 単位付き文字列をパース、異常値は null
5. **法人番号**: 指数表記を整数化、12/13桁のみ有効
